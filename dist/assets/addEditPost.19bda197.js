var E=Object.defineProperty;var h=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var p=(t,e,a)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,y=(t,e)=>{for(var a in e||(e={}))I.call(e,a)&&p(t,a,e[a]);if(h)for(var a of h(e))F.call(e,a)&&p(t,a,e[a]);return t};import{p as g,b as c,c as f,s as q,d as b}from"./toastify.f6c591f2.js";/* empty css                    */import{c as D,b as d,e as v}from"./vendor.423aa499.js";import{t as S}from"./toast.68c049d4.js";const n={PICSUM:"picsum",UPLOAD:"upload"};function A(t){let e={},a=new FormData(t);for(const[r,o]of a)e[r]=o;return e}function u(t,e,a){const r=t.querySelector(`[name=${e}]`);r&&(r.setCustomValidity(a),q(r.parentElement,".invalid-feedback",a))}function U(){return D().shape({title:d().required("Plase enter title"),author:d().required("Plase enter author name").test("at-least-2-words","Please enter at least two words",t=>t.split(" ").filter(e=>!!e&&e.length>=3).length>=2),description:d(),imageSource:d().required("Please select your image source").oneOf([n.PICSUM,n.UPLOAD]),imageUrl:d().when("imageSource",{is:n.PICSUM,then:d().required("Plase random an image for your background").url("Please enter a valid image URL")}),image:v().when("imageSource",{is:n.UPLOAD,then:v().test("required","Plase upload your image",t=>(t==null?void 0:t.size)>1).test("required","Plase select the file < 1MB",t=>(t==null?void 0:t.size)<1e3*1024)})})}function B(t){let e=document.getElementById("randomImgBtn");!e||e.addEventListener("click",()=>{let a=`https://picsum.photos/id/${b(1e3)}/1366/400`;c(t,"[name='imageUrl']",a),f(document,"postHeroImage",a)})}function O(t){document.querySelectorAll('[data-id="imageSource"]').forEach(a=>{a.hidden=a.dataset.imageSource!=t})}function V(t){const e=t.querySelector('[name="image"]');!e||e.addEventListener("change",a=>{const r=e.files[0];if(!r)return;const o=URL.createObjectURL(r);c(t,"[name='imageUrl']",o),f(document,"postHeroImage",o),P(t,{imageSource:n.UPLOAD,image:r},"image")})}function k(t){const e=y({},t);return e.imageSource==n.PICSUM&&delete e.image,e.imageSource==n.UPLOAD&&delete e.imageUrl,delete e.imageSource,e}function C(t){const e=new FormData;for(const a in t)e.set(a,t[a]);return e}async function $(t){try{const e=k(t),a=C(e);let r=t.id?await g.updateFormData(t):await g.addFormData(a);S.success("save post successfully!"),setTimeout(()=>window.location.assign(`/post-detail.html?id=${r.id}`),2e3)}catch(e){console.log(e),S.error(`Error: ${e.message}`)}}async function R(t,e){try{["title","author","imageUrl","image"].forEach(o=>{u(t,o,"")}),await U().validate(e,{abortEarly:!1})}catch(r){let o={};if(r.name==="ValidationError")for(const s of r.inner){const l=s.path;o[l]||(u(t,l,s.message),o[l]=!0)}}const a=t.checkValidity();return a||t.classList.add("was-validated"),a}async function P(t,e,a){try{u(t,a,""),await U().validateAt(a,e)}catch(o){u(t,a,o.message)}const r=t.querySelector(`[name="${a}"]`);r&!r.checkValidity()&&r.parentElement.classList.add("was-validated")}function M(t){["title","author"].forEach(e=>{const a=t.querySelector(`[name=${e}]`);a&&a.addEventListener("input",r=>{P(t,{[e]:r.target.value},e)})})}(async()=>{const e=new URLSearchParams(window.location.search).get("id");let a=e?await g.getById(e):{author:"",title:"",description:"",imageUrl:""};const r=document.getElementById("postForm");c(r,"[name='author']",a.author),c(r,"[name='title']",a.title),c(r,"[name='description']",a.description),c(r,"[name='imageUrl']",a.imageUrl),f(document,"postHeroImage",a.imageUrl),M(r),r.querySelectorAll("[name='imageSource']").forEach(i=>{i.addEventListener("change",m=>{O(m.target.value)})}),B(r),V(r);let s=!1;function l(){const i=document.querySelector(".btn-save");i&&(i.innerText="Saving...",i.disabled=!0)}function L(){const i=document.querySelector(".btn-save");i&&(i.innerText="Save",i.disabled=!1)}r.addEventListener("submit",async i=>{if(i.preventDefault(),s)return;s=!0;const m=A(r),w=await R(r,m);l(),w&&await $(m),L(),s=!1})})();
